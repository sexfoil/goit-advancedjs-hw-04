{"version":3,"file":"commonHelpers.js","sources":["../src/search-api.js","../src/index.js"],"sourcesContent":["import axios from 'axios';\n\n\nconst BASE_URL = 'https://pixabay.com/api/';\nconst PIXABAY_API_KEY = '40838558-c247548bc4ad52de754856e08';\n\nconst IMAGE_PARAM_TEMPLATE = {\n    key: PIXABAY_API_KEY,\n    q: '',\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true\n}\n\nfunction getSearchUrl(params) {\n    return `${BASE_URL}?${params}`;\n}\n\nfunction getParams(query, template) {\n    template.q = query;\n    return new URLSearchParams(template);    \n}\n\nasync function fetchUrl(query, searchTemplate = { key: PIXABAY_API_KEY }) {\n    const params = getParams(query, searchTemplate);\n    const data = await axios.get(getSearchUrl(params));\n    return data;\n}\n\n\nexport function findImages(searchQuery, per_page = 20, page = 1) {\n    IMAGE_PARAM_TEMPLATE.per_page = per_page;\n    IMAGE_PARAM_TEMPLATE.page = page;\n\n    return fetchUrl(searchQuery, IMAGE_PARAM_TEMPLATE);\n}","import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\"\n\nimport { findImages } from './search-api';\n\n\nconst elements = {\n    searchForm: document.querySelector('.search-form'),\n    searchButton: document.querySelector('button[type=\"submit\"]'),\n    gallery: document.querySelector('.gallery'),\n    guard: document.querySelector('.js-guard')\n}\n\nconst PER_PAGE = 40;\n\nlet totalHits = 0;\nlet currentPage = 1;\nlet searchQuery = '';\n\nlet gallery = new SimpleLightbox(\n    '.gallery a',\n    {\n        captionsData: 'alt',\n        captionDelay: 250\n    }\n);\n    \nconst guardOptions = {\n    root: null,\n    rootMargin: \"250px\",\n    treshhold: 1.0\n}\n\nconst scrollObserver = new IntersectionObserver(handlerLoadMore, guardOptions);\n\nfunction handlerLoadMore(entries) {\n    entries.forEach((entry) => {\n        if (entry.isIntersecting) {\n            currentPage += 1;\n            const searchResult = findImages(searchQuery, PER_PAGE, currentPage);\n    \n            searchResult\n                .then(result => {                    \n                    renderSearchResult(result.data);\n\n                    if (PER_PAGE * currentPage >= totalHits) {\n                        scrollObserver.unobserve(elements.guard);\n                        showMessage(\"We're sorry, but you've reached the end of search results.\");\n                    }\n                })\n                .catch(err => showErrorMessage(err.message));\n        }\n    });\n}\n\n\n\nfunction getListItemsHTML(hits) {\n    return hits.map(({ webformatURL, largeImageURL, tags, likes, views, comments, downloads }) => {\n        return `            \n                <div class=\"photo-card\">\n                    <a href=\"${largeImageURL}\"><img class=\"image\" src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" /></a>\n                    <div class=\"info\">\n                        <p class=\"info-item\">\n                            <b>Likes</b>\n                            <span>${likes}</span> \n                        </p>\n                        <p class=\"info-item\">\n                            <b>Views</b>\n                            <span>${views}</span>\n                        </p>\n                        <p class=\"info-item\">\n                            <b>Comments</b>\n                            <span>${comments}</span>\n                        </p>\n                        <p class=\"info-item\">\n                            <b>Downloads</b>\n                            <span>${downloads}</span>\n                        </p>\n                    </div>\n                </div>            \n        `\n    }).join('');\n}\n\nfunction renderSearchResult(data) {\n    elements.gallery.insertAdjacentHTML('beforeend', getListItemsHTML(data.hits));\n    gallery.refresh();\n\n    window.scrollBy({\n        top: 0,\n        behavior: \"smooth\",\n    });\n}\n\nfunction showErrorMessage(errorMessage) {\n    iziToast.show({\n        message: errorMessage,\n        messageColor: 'white',\n        backgroundColor: 'tomato',\n        timeout: 2500,\n        position: 'topRight'\n    });\n}\n\nfunction showMessage(message) {\n    iziToast.show({\n        message: message,\n        messageColor: 'white',\n        backgroundColor: 'green',\n        timeout: 3000,\n        position: 'topRight'\n    });\n}\n\nfunction resetSearchData() {\n    elements.gallery.innerHTML = '';\n    totalHits = 0;\n    currentPage = 1;\n    searchQuery = '';\n}\n\nfunction onSearchButtonClick(evt) {\n    evt.preventDefault();\n    const form = new FormData(elements.searchForm);\n    const userInput = form.get('searchQuery').trim().toLowerCase();\n\n    if (!userInput) {\n        showErrorMessage(\"Search query must be not empty!\");\n        return;\n    }\n\n    scrollObserver.unobserve(elements.guard);    \n    resetSearchData();\n\n    searchQuery = userInput;\n    const searchResult = findImages(searchQuery, PER_PAGE);\n    \n    searchResult\n        .then(result => {\n            if (result.data.hits.length === 0) {\n                throw new Error(\"Sorry, there are no images matching your search query. Please try again.\");\n            }\n            \n            totalHits = result.data.totalHits;\n            \n            showMessage(`Hooray! We found ${totalHits} images.`);\n            renderSearchResult(result.data);\n\n            if (PER_PAGE * currentPage < totalHits) {\n                scrollObserver.observe(elements.guard);\n            }\n        })\n        .catch(err => showErrorMessage(err.message));\n}\n\nelements.searchButton.addEventListener('click', onSearchButtonClick);\n"],"names":["BASE_URL","PIXABAY_API_KEY","IMAGE_PARAM_TEMPLATE","getSearchUrl","params","getParams","query","template","fetchUrl","searchTemplate","axios","findImages","searchQuery","per_page","page","elements","PER_PAGE","totalHits","currentPage","gallery","SimpleLightbox","guardOptions","scrollObserver","handlerLoadMore","entries","entry","result","renderSearchResult","showMessage","err","showErrorMessage","getListItemsHTML","hits","webformatURL","largeImageURL","tags","likes","views","comments","downloads","data","errorMessage","iziToast","message","resetSearchData","onSearchButtonClick","evt","userInput"],"mappings":"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"}